# MLOps DAG ë¶„ë¦¬ ì „ëµ ë° ê°€ì´ë“œ

ì´ ë¬¸ì„œëŠ” ë‹¤ì–‘í•œ ë¨¸ì‹ ëŸ¬ë‹ ìœ ìŠ¤ì¼€ì´ìŠ¤(ì´ë¯¸ì§€ ì²˜ë¦¬, ê¸ˆìœµ ë°ì´í„°, ì‹œê³„ì—´ ì˜ˆì¸¡ ë“±)ë¥¼ Airflow DAGë¡œ êµ¬í˜„í•  ë•Œì˜ íš¨ìœ¨ì ì¸ ë¶„ë¦¬ ì „ëµê³¼ êµ¬ì¡°ë¥¼ ì„¤ëª…í•©ë‹ˆë‹¤.

---

## 1. ê°œìš”

ë‹¨ì¼ DAG íŒŒì¼(`ml_pipeline_dag.py`)ì— ëª¨ë“  ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ì„ í¬í•¨í•˜ëŠ” ê²ƒì€ ìœ ì§€ë³´ìˆ˜ì™€ ë¦¬ì†ŒìŠ¤ ê´€ë¦¬ ì¸¡ë©´ì—ì„œ ë¹„íš¨ìœ¨ì ì…ë‹ˆë‹¤. ë°ì´í„°ì˜ ì„±ê²©, í•„ìš”í•œ ì»´í“¨íŒ… ìì›, ì‹¤í–‰ ì£¼ê¸°ì— ë”°ë¼ DAGë¥¼ ë¶„ë¦¬í•˜ëŠ” ê²ƒì´ ê¶Œì¥ë©ë‹ˆë‹¤.

### ëŒ€ìƒ ìœ ìŠ¤ì¼€ì´ìŠ¤
1. **MNIST (CNN)**: ì†ê¸€ì”¨ ì´ë¯¸ì§€ ë¶„ë¥˜
2. **CIFAR-10 (CNN)**: ì‚¬ë¬¼ ì´ë¯¸ì§€ ë¶„ë¥˜
3. **Tick Data**: ê¸ˆìœµ í‹± ë°ì´í„° ì²˜ë¦¬ ë° í•™ìŠµ
4. **ê°€ì •ì§‘ ì „ë ¥ ë°ì´í„° (LightGBM)**: ì‹œê³„ì—´ ì „ë ¥ ìˆ˜ìš” ì˜ˆì¸¡

---

## 2. DAG ë¶„ë¦¬ê°€ í•„ìš”í•œ ì´ìœ 

### 2.1 ë°ì´í„° ì„±ê²© ë° ì „ì²˜ë¦¬ ë¡œì§ì˜ ì°¨ì´
- **ì´ë¯¸ì§€ ë°ì´í„° (MNIST/CIFAR-10)**: í”½ì…€ ì •ê·œí™”(0~255 â†’ 0~1), ì°¨ì› ë³€ê²½(Channel First/Last), Augmentation ë“±ì´ í•„ìš”í•˜ë©° `numpy`, `torchvision` ë“±ì„ ì£¼ë¡œ ì‚¬ìš©í•©ë‹ˆë‹¤.
- **ê¸ˆìœµ í‹± ë°ì´í„°**: ê²°ì¸¡ì¹˜ ë³´ê°„, OHLC ë³€í™˜, ì´ë™í‰ê· ì„  ê³„ì‚°, ë…¸ì´ì¦ˆ ì œê±° ë“±ì´ í•„ìš”í•˜ë©° `Spark` ìœˆë„ìš° í•¨ìˆ˜ ì²˜ë¦¬ê°€ íš¨ìœ¨ì ì…ë‹ˆë‹¤.
- **ì „ë ¥ ë°ì´í„°**: ê³„ì ˆì„± ë¶„í•´, ìš”ì¼/ì‹œê°„ëŒ€ íŒŒìƒë³€ìˆ˜ ìƒì„±, Lag Feature ìƒì„±ì´ í•„ìš”í•˜ë©° `pandas` ì²˜ë¦¬ê°€ ì£¼ë¥¼ ì´ë£¹ë‹ˆë‹¤.

### 2.2 ì»´í“¨íŒ… ë¦¬ì†ŒìŠ¤(Resource) ìš”êµ¬ì‚¬í•­ì˜ ì°¨ì´
- **CNN (Vision)**: ëª¨ë¸ í•™ìŠµ ì‹œ **GPU** ê°€ì†ì´ í•„ìˆ˜ì ì…ë‹ˆë‹¤. Airflow Workerë³´ë‹¤ëŠ” `KubernetesPodOperator` ë“±ì„ í†µí•´ GPU ë…¸ë“œë¥¼ í• ë‹¹í•´ì•¼ í•©ë‹ˆë‹¤.
- **Tick Data (Finance)**: ë°ì´í„° ì–‘ì´ ë°©ëŒ€í•˜ë¯€ë¡œ **Spark í´ëŸ¬ìŠ¤í„°** ì—°ë™ì´ í•µì‹¬ì…ë‹ˆë‹¤. `SparkSubmitOperator`ë¥¼ ì‚¬ìš©í•´ì•¼ í•©ë‹ˆë‹¤.
- **LightGBM (Energy)**: **CPU** ì½”ì–´ ìˆ˜ì™€ **ë©”ëª¨ë¦¬** ìš©ëŸ‰ì´ ì¤‘ìš”í•©ë‹ˆë‹¤.

### 2.3 ì‹¤í–‰ ì£¼ê¸°(Schedule)ì˜ ì°¨ì´
- **ê¸ˆìœµ ë°ì´í„°**: ì£¼ì‹ ì‹œì¥ ë§ˆê° ì§í›„(ì˜ˆ: ë§¤ì¼ 16:00) ì •ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
- **ì „ë ¥ ë°ì´í„°**: ê²€ì¹¨ì¼ ê¸°ì¤€(ì˜ˆ: ë§¤ì›” 1ì¼) ë˜ëŠ” ì‹¤ì‹œê°„ ì˜ˆì¸¡(15ë¶„ ë‹¨ìœ„)ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ì—°êµ¬ìš© ëª¨ë¸(Vision)**: ë¹„ì •ê¸°ì (Manual Trigger)ì´ê±°ë‚˜ ì£¼ 1íšŒ ì¬í•™ìŠµ ë“± ì‹¤í—˜ì ì¸ ì„±ê²©ì´ ê°•í•©ë‹ˆë‹¤.

---

## 3. ì¶”ì²œ DAG êµ¬ì¡° ì „ëµ

ìœ ì‚¬í•œ ì„±ê²©ì˜ ì‘ì—…ë¼ë¦¬ ê·¸ë£¹í™”í•˜ì—¬ 3ê°œì˜ ì£¼ìš” DAGë¡œ ë¶„ë¦¬í•˜ëŠ” ê²ƒì„ ì œì•ˆí•©ë‹ˆë‹¤.

### ğŸ“‚ 1. Vision & Deep Learning DAG
- **íŒŒì¼ëª…**: `dag_vision_classifier.py`
- **ëŒ€ìƒ**: MNIST, CIFAR-10
- **ì£¼ìš” íŠ¹ì§•**:
  - PyTorch/TensorFlow ì‚¬ìš©
  - GPU ë¦¬ì†ŒìŠ¤ í™œìš© ë¡œì§ í¬í•¨
  - ë°ì´í„°ì…‹ë§Œ ë‹¤ë¥´ê³  ë¡œì§ì´ ìœ ì‚¬í•˜ë¯€ë¡œ, í•˜ë‚˜ì˜ DAG íŒŒì¼ ë‚´ì—ì„œ íŒŒë¼ë¯¸í„°ë¡œ ë¶„ê¸°í•˜ê±°ë‚˜ Dynamic DAGë¥¼ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ğŸ“‚ 2. Finance & Big Data DAG
- **íŒŒì¼ëª…**: `dag_finance_tick.py`
- **ëŒ€ìƒ**: Tick Data
- **ì£¼ìš” íŠ¹ì§•**:
  - `fspark_raw_examples.py`ì™€ ê°™ì€ Spark ì‘ì—… ì œì¶œì´ í•µì‹¬
  - ë°ì´í„° ìˆ˜ì§‘(Raw) -> ì •ì œ(Silver) -> ì§€í‘œ ìƒì„±(Gold) ë‹¨ê³„ê°€ ë§¤ìš° ë¬´ê±°ì›€
  - S3/Iceberg í…Œì´ë¸”ê³¼ì˜ ê¸´ë°€í•œ ì—°ë™ í•„ìš”

### ğŸ“‚ 3. Energy & Tabular ML DAG
- **íŒŒì¼ëª…**: `dag_energy_forecast.py`
- **ëŒ€ìƒ**: ê°€ì •ì§‘ ì „ë ¥ ë°ì´í„°
- **ì£¼ìš” íŠ¹ì§•**:
  - Scikit-learn, LightGBM, XGBoost ì‚¬ìš©
  - ì •êµí•œ Feature Engineering(ì‹œê³„ì—´ íŠ¹ì„± ì¶”ì¶œ)ì´ í•µì‹¬
  - PythonOperator ìœ„ì£¼ì˜ êµ¬ì„± ê°€ëŠ¥ (ë©”ëª¨ë¦¬ ìµœì í™” í•„ìš”)

---

## 4. ìƒì„¸ êµ¬í˜„ ê°€ì´ë“œ (ì˜ˆì‹œ)

### 4.1 `dag_vision_classifier.py` êµ¬ì¡°
```python
# GPU ë¦¬ì†ŒìŠ¤ê°€ í•„ìš”í•œ ì‘ì—…
with DAG("vision_cnn_classifier", ...) as dag:
    
    # ë°ì´í„° ë‹¤ìš´ë¡œë“œ ë° ì „ì²˜ë¦¬
    preprocess = PythonOperator(task_id="preprocess_images", ...)
    
    # ëª¨ë¸ í•™ìŠµ (GPU í™œìš©ì„ ìœ„í•´ Docker/K8s Operator ê¶Œì¥)
    train = PythonOperator(
        task_id="train_cnn_model",
        python_callable=train_cnn_function,
        # ...
    )
```

### 4.2 `dag_finance_tick.py` êµ¬ì¡°
```python
# Spark í´ëŸ¬ìŠ¤í„° ì—°ë™ì´ í•„ìš”í•œ ì‘ì—…
with DAG("finance_tick_processor", ...) as dag:
    
    # Spark ì‘ì—… ì œì¶œ
    process_ticks = SparkSubmitOperator(
        task_id="process_tick_data",
        application="s3://scripts/process_ticks.py",
        conf={"spark.executor.memory": "4g"},
        # ...
    )
```

### 4.3 `dag_energy_forecast.py` êµ¬ì¡°
```python
# CPU/Memory ì§‘ì•½ì  ì‘ì—…
with DAG("energy_demand_forecast", ...) as dag:
    
    # ë°ì´í„° ë¡œë“œ ë° í”¼ì²˜ ì—”ì§€ë‹ˆì–´ë§
    feature_eng = PythonOperator(task_id="feature_engineering", ...)
    
    # LightGBM í•™ìŠµ
    train_lgbm = PythonOperator(task_id="train_lightgbm", ...)
```

---

**ì‘ì„±**: Gemini Code Assist