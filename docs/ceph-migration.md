# Ceph(RGW) ë„ì…/ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ

> ëª©ì : Ceph RADOS Gateway(RGW) ë„ì… ë° ê¸°ì¡´ S3 ê¸°ë°˜ ìŠ¤í† ë¦¬ì§€ì—ì„œì˜ ì „í™˜ ì´ìœ , ì‚¬ì „ ì¤€ë¹„, êµ¬ì²´ì  ìˆ˜ì • í•­ëª©, ê²€ì¦ ë°©ë²•, ë¡¤ë°± ë° ì£¼ì˜ì‚¬í•­ì„ ìƒì„¸íˆ ì •ë¦¬í•©ë‹ˆë‹¤.

---

## ğŸ“Œ ìš”ì•½ (í•œëˆˆì—)
- êµì²´ ì´ìœ : ì£¼ëœ ë™ê¸°ëŠ” **2025ë…„ ì¼ë¶€ S3 êµ¬í˜„ì˜ ì˜¤í”ˆì†ŒìŠ¤ ì •ì±… ë³€ê²½(ì˜ˆ: MinIO)**ìœ¼ë¡œ ì¸í•œ ë¶ˆí™•ì‹¤ì„±ê³¼ ì œì•½ ê°€ëŠ¥ì„±ì…ë‹ˆë‹¤. ì´ë¡œ ì¸í•´ ì¥ê¸°ì ì¸ ìš´ì˜ ì•ˆì •ì„±, ë¼ì´ì„ ìŠ¤/ê·œì • ì¤€ìˆ˜, ë¹„ìš©Â·ì§€ì› ì¸¡ë©´ì—ì„œ ë¦¬ìŠ¤í¬ê°€ ì»¤ì§ˆ ìˆ˜ ìˆì–´, ì˜¤í”ˆì†ŒìŠ¤ ê¸°ë°˜ì˜ ë³´ë‹¤ ì•ˆì •ì ì¸ ìŠ¤í† ë¦¬ì§€(ì˜ˆ: Ceph RGW)ë¡œ ì´ì „ì„ ê¶Œì¥í•©ë‹ˆë‹¤.
- Cephë¡œì˜ ê¸°ìˆ ì  ì´ì : Ceph RGWëŠ” ì—”í„°í”„ë¼ì´ì¦ˆê¸‰ ë¶„ì‚° ìŠ¤í† ë¦¬ì§€(í™•ì¥ì„±, ë‚´êµ¬ì„±, ë©€í‹° í…Œë„Œì‹œ, ì •ì±…, ëª¨ë‹ˆí„°ë§)ë¥¼ ì œê³µí•˜ë©° S3 í˜¸í™˜ APIë¥¼ í†µí•´ ê¸°ì¡´ S3 í˜¸í™˜ ì‚¬ìš© ì½”ë“œë¥¼ ëŒ€ë¶€ë¶„ ë³€ê²½ ì—†ì´ ì¬ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ë°©ì‹ ì„ íƒ:
  - ì™¸ë¶€(ê¸°ì¡´ ë˜ëŠ” ê´€ë¦¬í˜•) Ceph RGW ì‚¬ìš©(ê¶Œì¥): ì¸í”„ë¼ ë³µì¡ë„ ë‚®ìŒ, ìš´ì˜ ì•ˆì •ì„± ìš°ìˆ˜
  - ë¡œì»¬ Dockerì— RGW ë°°í¬(í…ŒìŠ¤íŠ¸ìš©, ê¶Œì¥í•˜ì§€ ì•ŠìŒ): ê°„ë‹¨ í…ŒìŠ¤íŠ¸ ê°€ëŠ¥í•˜ì§€ë§Œ ìš´ì˜ìš©ìœ¼ë¡œëŠ” ë³µì¡í•˜ê³  ë¹„ê¶Œì¥
- ì˜í–¥ ë²”ìœ„: Docker/Docker Compose, `hive-site.xml`, `python/fspark.py`, `trino-config/*`, ìŠ¤í¬ë¦½íŠ¸ ë° ì‚¬ìš©ì ìê²©ì¦ëª…, ë²„í‚·/ê¶Œí•œ êµ¬ì¡°

> **ì¤‘ìš”:** ì´ ë¬¸ì„œëŠ” **Ceph(RGW)ë¥¼ ì£¼ ê¶Œì¥ ì†”ë£¨ì…˜**ìœ¼ë¡œ ê°€ì •í•˜ì—¬ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤. ì•„ë˜ì— ì—´ê±°ëœ ë‹¤ë¥¸ ì˜¤í”ˆì†ŒìŠ¤ ëŒ€ì•ˆì€ *ì°¸ê³ ìš©*ì´ë©°, ì‹¤ì œ ë„ì… ê²€í†  ì‹œì—ëŠ” Cephë¥¼ ìš°ì„  ê²€í† í•˜ì‹­ì‹œì˜¤.

---

## âœ… ì™œ Cephë¡œ êµì²´í•˜ë‚˜?

### ì£¼ìš” ë™ê¸°: ì¼ë¶€ S3 êµ¬í˜„ì˜ ì˜¤í”ˆì†ŒìŠ¤ ì •ì±… ë³€ê²½ (í•µì‹¬)
- 2025ë…„ì— ë°œí‘œëœ ì¼ë¶€ S3 êµ¬í˜„ì˜ ì˜¤í”ˆì†ŒìŠ¤ ì •ì±…/ë°°í¬ ê´€ë ¨ ë³€ê²½(ì˜ˆ: MinIO)ì€ ì¼ë¶€ ì¡°ì§ì—ì„œ **ë¼ì´ì„ ìŠ¤, ìƒì—…ì  ì´ìš© ì¡°ê±´, ë°°í¬Â·ì¬ë°°í¬ ì œí•œ** ë“±ì—ì„œ ë¶ˆí™•ì‹¤ì„±ì„ ì´ˆë˜í–ˆìŠµë‹ˆë‹¤.
- ì´ë¡œ ì¸í•´ ì¥ê¸° ìš´ì˜ê³„íš(ê·œì • ì¤€ìˆ˜, ë¹„ìš© ì˜ˆì¸¡, ê³µê¸‰ì ì¢…ì†ì„±) ì¸¡ë©´ì—ì„œ ë¦¬ìŠ¤í¬ê°€ ì»¤ì¡Œê³ , ë”°ë¼ì„œ **ì˜¤í”ˆì†ŒìŠ¤ ì»¤ë®¤ë‹ˆí‹° ë° ì—”í„°í”„ë¼ì´ì¦ˆ ì§€ì›ì´ ë” ëª…í™•í•œ ëŒ€ì•ˆ**(ì˜ˆ: Ceph RGW)ìœ¼ë¡œ ì´ì „ì„ ê³ ë ¤í•˜ëŠ” ê²ƒì´ í•©ë¦¬ì ì…ë‹ˆë‹¤.

### Ceph(RGW)ì˜ ê¸°ìˆ ì  ì´ì 
- í™•ì¥ì„± ë° ë°ì´í„° ë‚´êµ¬ì„±(ì‹¤ì œ ë¶„ì‚° ìŠ¤í† ë¦¬ì§€)
- ì •ì±…/ë¼ì´í”„ì‚¬ì´í´/ë¦¬ì „ ê¸°ëŠ¥
- í†µí•© ëª¨ë‹ˆí„°ë§/ìš´ì˜ ê¸°ëŠ¥(RADOS, MON, OSD ë“±)
- ì—”í„°í”„ë¼ì´ì¦ˆ ìš”êµ¬ì‚¬í•­(ë‹¤ì¤‘ í…Œë„ŒíŠ¸, ACL, ì‚¬ìš©ì ê´€ë¦¬)

> ë‹¨, CephëŠ” ìš´ì˜ ë³µì¡ë„ê°€ ìˆìœ¼ë¯€ë¡œ ì‘ì€ ì‹¤í—˜/ê°œë°œìš© ì‹œìŠ¤í…œì—ëŠ” Garage ë˜ëŠ” ë¡œì»¬ S3 í˜¸í™˜ í…ŒìŠ¤íŠ¸ ì„œë¹„ìŠ¤(ì˜ˆ: Garage, Moto, ê²½ëŸ‰ S3 ê²Œì´íŠ¸ì›¨ì´)ë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì´ ë” ê°„ë‹¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

## Cephê°€ ë‹´ë‹¹í•˜ëŠ” ë ˆì´ì–´ (ì—­í•  ë° ì±…ì„)
Ceph(RGW)ëŠ” ë‹¨ìˆœí•œ S3 ì—”ë“œí¬ì¸íŠ¸ ì´ìƒì˜ "ì €ì¥Â·ìš´ì˜ ë ˆì´ì–´"ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤. ì•„ë˜ëŠ” Ceph/RGWê°€ ì‹¤ì œë¡œ ì±…ì„ì§€ëŠ” ì£¼ìš” í•­ëª©ê³¼ ë‹¤ë¥¸ ì‹œìŠ¤í…œê³¼ì˜ ìƒí˜¸ì‘ìš©ì…ë‹ˆë‹¤.

- ê°ì²´ ìŠ¤í† ë¦¬ì§€ ì œê³µ
  - ë²„í‚·/ê°ì²´ ì €ì¥ì†Œë¥¼ ì œê³µí•˜ë©°, Iceberg/Parquet íŒŒì¼, íŒŒí‹°ì…˜, ë¡œê·¸ ë“± ëª¨ë“  ë°ì´í„° íŒŒì¼ì„ ë³´ê´€í•©ë‹ˆë‹¤.
  - í´ë¼ì´ì–¸íŠ¸ ê´€ì ì—ì„œ S3 í˜¸í™˜ API(RGW)ë¥¼ í†µí•´ ì ‘ê·¼í•©ë‹ˆë‹¤.

- ë°ì´í„° ë‚´êµ¬ì„± ë° ë³µì œ(Replication / Erasure Coding)
  - OSD(ì˜¤ë¸Œì íŠ¸ ìŠ¤í† ë¦¬ì§€ ë°ëª¬)ì™€ RADOS ë ˆì´ì–´ë¥¼ í†µí•´ ë¸”ë¡ ìˆ˜ì¤€ìœ¼ë¡œ ë°ì´í„° ë³µì œ ë˜ëŠ” erasure codingìœ¼ë¡œ ë‚´êµ¬ì„±ì„ ë³´ì¥í•©ë‹ˆë‹¤.

- ì¸ì¦Â·ê¶Œí•œÂ·ì‚¬ìš©ì ê´€ë¦¬
  - RGWê°€ ë°œê¸‰í•˜ëŠ” ì•¡ì„¸ìŠ¤í‚¤/ì‹œí¬ë¦¿ì„ í†µí•´ ì„œë¹„ìŠ¤ ë° ì‚¬ìš©ì ì¸ì¦ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.
  - ë²„í‚· ì •ì±…, ACL, ì‚¬ìš©ìë³„ ê¶Œí•œ(ì½ê¸°/ì“°ê¸° ë“±)ì„ ì ìš©í•©ë‹ˆë‹¤.

- S3 í˜¸í™˜ì„±ê³¼ API ì±…ì„
  - S3(SigV2/SigV4) ìš”ì²­ íŒŒì‹±, ê¶Œí•œ ê²€ì‚¬, ë©€í‹°íŒŒíŠ¸ ì—…ë¡œë“œ, ê°ì²´ ë©”íƒ€ë°ì´í„° ê´€ë¦¬ ë“±ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

- ì„±ëŠ¥Â·ìŠ¤ë£¨í’‹Â·ì¼ê´€ì„± ì •ì±…
  - ì½ê¸°/ì“°ê¸° ì„±ëŠ¥ì€ cluster êµ¬ì„±(OSD ìˆ˜, ë„¤íŠ¸ì›Œí¬, erasure/replication ì„¤ì •)ì— ì¢Œìš°ë©ë‹ˆë‹¤.
  - ìºì‹œ, RGW ìŠ¤ë ˆë“œ/ë²„í‚· ìƒ¤ë”© ë“± íŠœë‹ í¬ì¸íŠ¸ê°€ ì¡´ì¬í•©ë‹ˆë‹¤.

- ê´€ë¦¬Â·ìš´ì˜ ê¸°ëŠ¥
  - ëª¨ë‹ˆí„°ë§(Prometheus exporter), ë¡œê·¸, OSD êµì²´, ìŠ¤ì¼€ì¼ ì•„ì›ƒ/ì¸, ì¥ì•  ë³µêµ¬ ì ˆì°¨ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤.

- ë°ì´í„° ìˆ˜ëª…ì •ì±…ê³¼ ë³µì œ(ë¼ì´í”„ì‚¬ì´í´)
  - ê°ì²´ ìˆ˜ëª…(Lifecycle)/ë ˆí”Œë¦¬ì¼€ì´ì…˜ ì •ì±…ì„ í†µí•´ ë¹„ìš©/ë³´ì¡´ ì •ì±…ì„ ì ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

- ë©€í‹° ì‚¬ì´íŠ¸/ë¦¬ì „ ë³µì œ (ì„ íƒì )
  - CRUSH ë§µ/ë¦¬ì „ êµ¬ì„±ì„ í†µí•œ ë©€í‹°ë¦¬ì „ ë³µì œë‚˜ RADOS Gatewayì˜ ë¦¬ì „ê°„ ë³µì œë¥¼ í†µí•´ ì¬í•´ë³µêµ¬(Disaster Recovery)ë¥¼ ì§€ì›í•©ë‹ˆë‹¤.

### ë‹¤ë¥¸ ì‹œìŠ¤í…œê³¼ì˜ ì—­í•  ë¶„ë‹´ (ì‹¤ë¬´ ê´€ì )
- Hive Metastore
  - ë©”íƒ€ë°ì´í„°(í…Œì´ë¸”Â·íŒŒí‹°ì…˜ ì •ë³´)ëŠ” Hive Metastoreê°€ ê´€ë¦¬í•˜ê³ , ì‹¤ì œ í…Œì´ë¸” íŒŒì¼ì€ Ceph(RGW)ê°€ í˜¸ìŠ¤íŠ¸í•©ë‹ˆë‹¤.

- Apache Iceberg
  - Iceberg ë©”íƒ€ì™€ ìŠ¤ëƒ…ìƒ·ì„ ì‚¬ìš©í•˜ë˜, Icebergê°€ ì°¸ì¡°í•˜ëŠ” ë°ì´í„° íŒŒì¼(ìŠ¤ëƒ…ìƒ·, ìŠ¤í‚¤ë§ˆ, Parquet íŒŒì¼)ì€ Cephì˜ ê°ì²´ë¡œ ì €ì¥ë©ë‹ˆë‹¤. Icebergì˜ `io-impl`(S3FileIO ë“±)ì´ RGW endpointë¥¼ í†µí•´ ì½ê³  ì”ë‹ˆë‹¤.

- Spark
  - Spark(ë˜ëŠ” Spark+Iceberg)ëŠ” `fs.s3a.*`ì™€ Iceberg ì¹´íƒˆë¡œê·¸ ì„¤ì •(`spark.sql.catalog.*.s3.endpoint` ë“±)ì„ í†µí•´ RGWë¡œ íŒŒì¼ì„ ì½ê³  ì”ë‹ˆë‹¤.

- Trino
  - TrinoëŠ” Iceberg ì»¤ë„¥í„°ë¥¼ í†µí•´ ë©”íƒ€ë°ì´í„°(Hive)ì™€ íŒŒì¼(Ceph)ì„ ì¡°íšŒ/ì¿¼ë¦¬í•©ë‹ˆë‹¤. Trinoì˜ S3 ê´€ë ¨ ì„¤ì •ì€ RGW ì ‘ê·¼ì„ ê°€ëŠ¥í•˜ê²Œ í•´ì•¼ í•©ë‹ˆë‹¤.

### ìš´ì˜ìƒ ê³ ë ¤ì‚¬í•­ (ìš”ì•½)
- ì—”ë“œí¬ì¸íŠ¸/ìê²©ì¦ëª… í‘œì¤€í™”: ëª¨ë“  ì„œë¹„ìŠ¤ì—ì„œ ë™ì¼í•œ endpoint/key/secret/ê²½ë¡œ(`s3a://lakehouse/warehouse/`) ì‚¬ìš©
- ë³´ì•ˆ: RGW ì•ë‹¨ TLS ì ìš©, í‚¤ ê´€ë¦¬(ì‹œí¬ë¦¿ ì•”í˜¸í™”) í•„ìš”
- ìš©ëŸ‰ ê³„íš: OSD, ë„¤íŠ¸ì›Œí¬, ì €ë„/DB(ë©”íƒ€ìš©) ìš©ëŸ‰ ì‚°ì •
- ëª¨ë‹ˆí„°ë§: RGW, MON, OSD ë©”íŠ¸ë¦­ ìˆ˜ì§‘(Prometheus), ì•ŒëŒ ì„¤ì •
- í…ŒìŠ¤íŠ¸: ì½ê¸°/ì“°ê¸°, ë©€í‹°íŒŒíŠ¸ ì—…ë¡œë“œ, í° ì˜¤ë¸Œì íŠ¸ í•¸ë“¤ë§, ì¥ì•  ì‹œ ë³µêµ¬(OSD êµì²´ ë“±) ê²€ì¦

## í‚¤ ìƒì„± ë° ì£¼ì… (ê¶Œì¥ ì ˆì°¨)
> **ì›ì¹™:** RGW(ë˜ëŠ” Ceph)ê°€ ì •ìƒ ë™ì‘í•œ í›„ì— S3 ì•¡ì„¸ìŠ¤ í‚¤(access/secret)ë¥¼ ìƒì„±í•˜ê³ , ì•ˆì „í•œ ì‹œí¬ë¦¿ ìŠ¤í† ë¦¬ì§€(ì˜ˆ: Vault, Kubernetes Secret, Docker Secret)ë¥¼ í†µí•´ ì„œë¹„ìŠ¤ì— ì£¼ì…í•˜ì„¸ìš”. í‚¤ëŠ” ì†ŒìŠ¤ ì½”ë“œë‚˜ ë¦¬í¬ì§€í† ë¦¬ì— ì ˆëŒ€ ì»¤ë°‹í•˜ì§€ ë§ˆì‹­ì‹œì˜¤.

1. RGWì—ì„œ ì‚¬ìš©ì/í‚¤ ìƒì„±
   - radosgw-admin (Ceph ë…¸ë“œ ë˜ëŠ” tools pod ë‚´)
     ```bash
     radosgw-admin user create --uid=lakehouse-user --display-name="lakehouse user"
     radosgw-admin user info --uid=lakehouse-user
     # ì¶œë ¥: access_key / secret_key
     # ë˜ëŠ” í‚¤ ì§ì ‘ ì§€ì •
     radosgw-admin user create --uid=lakehouse-user --display-name="lakehouse" --access-key=YOURKEY --secret=YOURSECRET
     ```
   - Rook (k8s) í™˜ê²½:
     ```bash
     kubectl -n rook-ceph exec -it deploy/rook-ceph-tools -- radosgw-admin user create --uid=lakehouse-user --display-name="lakehouse"
     ```
   - Ceph Dashboard: UIì—ì„œ Object Gateway â†’ Users â†’ Create user

2. í‚¤ ì €ì¥ ë° ì£¼ì…
   - **Kubernetes:** `kubectl create secret generic ceph-credentials --from-literal=AWS_ACCESS_KEY_ID=... --from-literal=AWS_SECRET_ACCESS_KEY=...`
   - **Docker Compose:** `.env`ì— ê°’ ì„¤ì •(ê°œë°œ) ë˜ëŠ” Docker secrets ì‚¬ìš©(ê¶Œì¥)
     ```env
     AWS_ACCESS_KEY_ID=your_access_key_here
     AWS_SECRET_ACCESS_KEY=your_secret_here
     S3_ENDPOINT=http://ceph-rgw:8000
     ```
   - **Vault/Secrets Manager:** ìš´ì˜ í™˜ê²½ì—ì„œëŠ” Vaultë‚˜ í´ë¼ìš°ë“œ ì‹œí¬ë¦¿ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•´ í‚¤ë¥¼ ë™ì ìœ¼ë¡œ ì£¼ì…í•˜ì„¸ìš”.

3. ì„œë¹„ìŠ¤ ì¬ì‹œì‘ ë° ê²€ì¦
   - í‚¤ ì£¼ì… í›„ ì„œë¹„ìŠ¤(ì˜ˆ: Hive, Spark, Trino)ë¥¼ ì¬ì‹œì‘í•˜ê±°ë‚˜ ì¬ë°°í¬í•˜ì„¸ìš”.
   - ê²€ì¦:
     ```bash
     AWS_ACCESS_KEY_ID=your_access_key AWS_SECRET_ACCESS_KEY=your_secret aws --endpoint-url http://ceph-rgw:8000 s3 ls
     aws --endpoint-url http://ceph-rgw:8000 s3api create-bucket --bucket lakehouse
     ```

4. ìš´ì˜ ê¶Œì¥ì‚¬í•­
   - í‚¤ ë¡œí…Œì´ì…˜ ì •ì±… ìˆ˜ë¦½, ì‚¬ìš© ë¡œê·¸(ê°ì‚¬) í™œì„±í™”
   - ìµœì†Œ ê¶Œí•œ(least privilege): í•„ìš”í•œ ë²„í‚·ê³¼ ë™ì‘ë§Œ í—ˆìš©
   - í‚¤ ìƒì„± ê³¼ì • ë° ê¶Œí•œ ë¶€ì—¬ëŠ” ìë™í™”ëœ ì›Œí¬í”Œë¡œ(ì˜ˆ: Terraform, Ansible, K8s operator)ë¡œ ê´€ë¦¬í•˜ë©´ ì•ˆì „ì„±ì´ í–¥ìƒë©ë‹ˆë‹¤.

> ì°¸ê³ : í…ŒìŠ¤íŠ¸ ëª©ì (ë¡œì»¬ ê°œë°œ)ì´ë¼ë©´ ê°€ë²¼ìš´ S3 í˜¸í™˜ ì„œë¹„ìŠ¤(Garage ë“±)ë¥¼ ì´ìš©í•´ ë¹ ë¥´ê²Œ ê²€ì¦í•œ ë’¤, ìŠ¤í…Œì´ì§•/í”„ë¡œë•ì…˜ì—ì„œ Ceph RGWë¡œ ì „í™˜í•˜ëŠ” ìˆœì„œë¥¼ ê¶Œì¥í•©ë‹ˆë‹¤.
> ìš”ì•½: CephëŠ” ë‹¨ì§€ "íŒŒì¼ì„ ì €ì¥í•˜ëŠ” ê³³"ì´ ì•„ë‹ˆë¼ ë°ì´í„° ê°€ìš©ì„±Â·ë‚´êµ¬ì„±Â·ë³´ì•ˆÂ·ìš´ì˜ì„± ì „ë°˜ì„ ì±…ì„ì§€ëŠ” í•µì‹¬ ì¸í”„ë¼ ë ˆì´ì–´ì…ë‹ˆë‹¤.

---

## ì‚¬ì „ ì¤€ë¹„
1. Ceph(RGW) ì ‘ê·¼ ì •ë³´ë¥¼ í™•ë³´:
   - RGW í˜¸ìŠ¤íŠ¸/í¬íŠ¸ (ì˜ˆ: `rgw.example.com:8000`)
   - ì•¡ì„¸ìŠ¤ í‚¤ / ì‹œí¬ë¦¿ í‚¤ (S3 í˜•íƒœ)
   - ì‚¬ìš©í•  ë²„í‚· ì´ë¦„ (ì˜ˆ: `lakehouse`)
2. Ceph RGWì—ì„œ S3 í˜¸í™˜ ê¸°ëŠ¥(íŠ¹íˆ SigV4)ì„ í™œì„±í™” í™•ì¸
3. ì„œë¹„ìŠ¤ ë‹¤ìš´íƒ€ì„ ê³„íš(ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ì´ í•„ìš”í•œ ê²½ìš°)
4. í˜„ì¬ ì‚¬ìš© ì¤‘ì¸ ê°ì²´ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ëœ ë°ì´í„° ë°±ì—…/ì´ì „ ê³„íš (í•„ìš” ì‹œ)

---

## ë³€ê²½í•´ì•¼ í•  íŒŒì¼ë“¤ (ìš°ì„ ìˆœìœ„ ìˆœ)
- `docker-compose.yml` (ì´ì „ S3 ì„œë¹„ìŠ¤ ì œê±° ë˜ëŠ” ì£¼ì„ ì²˜ë¦¬; RGW ì„œë¹„ìŠ¤ ì¶”ê°€ëŠ” ì„ íƒ)
- `hive-conf/hive-site.xml` â€” `fs.s3a.endpoint`, `fs.s3a.access.key`, `fs.s3a.secret.key`, `hive.metastore.warehouse.dir` ë“±
- `python/fspark.py` â€” `spark.hadoop.fs.s3a.*`, `spark.sql.catalog.*.s3.endpoint`, `spark.sql.catalog.*.warehouse` ë“±
- `trino-config/catalog/iceberg.properties` â€” Trinoì—ì„œ S3 ì—°ê²° ì„¤ì • ì¶”ê°€/ìˆ˜ì •
- ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ ë˜ëŠ” í™˜ê²½ íŒŒì¼ (env vars) â€” ìê²©ì¦ëª… í†µí•©

---

## êµ¬ì²´ì  ìˆ˜ì • ì˜ˆì œ

### 1) docker-compose.yml
- (ê¶Œì¥) ê¸°ì¡´ S3 ì„œë¹„ìŠ¤ëŠ” ë³´ê´€í•˜ê±°ë‚˜ ì´ë¦„ ë³€ê²½ í›„ ë¹„í™œì„±í™”.
- ë¡œì»¬ RGWë¥¼ ì‚¬ìš©í•˜ë ¤ë©´(í…ŒìŠ¤íŠ¸ ì „ìš©) ì„œë¹„ìŠ¤ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìœ¼ë‚˜, ì‹¤ì œ ìš´ì˜ì—ì„œëŠ” ì™¸ë¶€ RGW ê¶Œì¥.

ì˜ˆ: ê¸°ì¡´ S3 ì„œë¹„ìŠ¤ë¥¼ `ceph-rgw`ë¡œ êµì²´í•˜ëŠ” ê°„ë‹¨ ì˜ˆì‹œ(í…ŒìŠ¤íŠ¸ìš©)
```yaml
services:
  ceph-rgw:
    image: ceph/daemon:latest
    container_name: ceph-rgw
    ports:
      - "8000:8000"
    # ì‹¤ì œ ìš´ì˜ìš©ìœ¼ë¡œëŠ” cephadm/rookë¡œ í´ëŸ¬ìŠ¤í„°ë¥¼ êµ¬ì„±í•´ì•¼ í•©ë‹ˆë‹¤.
```

> ìš´ì˜ í™˜ê²½ì—ì„œëŠ” ì™¸ë¶€ RGWë¥¼ ì‚¬ìš©í•˜ê³  Dockerì—ì„œ endpoint/keysë§Œ ë³€ê²½í•˜ëŠ” ë°©ë²• ê¶Œì¥.


### 2) `hive-conf/hive-site.xml`
- ë°”ê¿€ í•­ëª©:
```xml
<property>
  <name>fs.s3a.endpoint</name>
  <value>http://RGW_HOST:8000</value>
</property>
<property>
  <name>fs.s3a.access.key</name>
  <value>CEPH_ACCESS_KEY</value>
</property>
<property>
  <name>fs.s3a.secret.key</name>
  <value>CEPH_SECRET_KEY</value>
</property>
<property>
  <name>fs.s3a.path.style.access</name>
  <value>true</value>
</property>
<property>
  <name>hive.metastore.warehouse.dir</name>
  <value>s3a://lakehouse/warehouse/</value>
</property>
```

> ì£¼ì˜: `path style access=true`ë¡œ í•´ì•¼ í˜¸ìŠ¤íŠ¸ ê¸°ë°˜ ì£¼ì†Œê°€ ì•„ë‹Œ `s3a://bucket/...` í˜•íƒœë¡œ ë™ì‘í•˜ê²Œ í•´ì¤ë‹ˆë‹¤.


### 3) `python/fspark.py` (ë¡œì»¬ í´ë¼ì´ì–¸íŠ¸)
- ë³€ê²½ ì˜ˆì‹œ:
```python
.config("spark.sql.catalog.hive_prod.s3.endpoint", "http://RGW_HOST:8000")
.config("spark.sql.catalog.hive_prod.warehouse", "s3a://lakehouse/warehouse/")
.config("spark.hadoop.fs.s3a.access.key", "CEPH_ACCESS_KEY")
.config("spark.hadoop.fs.s3a.secret.key", "CEPH_SECRET_KEY")
.config("spark.hadoop.fs.s3a.path.style.access", "true")
```


### 4) `trino-config/catalog/iceberg.properties`
- Trinoì—ì„œëŠ” ì¹´íƒˆë¡œê·¸ì— S3 ì†ì„±(ë²„ì „ë³„ë¡œ ì˜µì…˜ëª…ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)ì„ ì¶”ê°€í•©ë‹ˆë‹¤:
```properties
connector.name=iceberg
iceberg.catalog.type=hive_metastore
hive.metastore.uri=thrift://hive-metastore:9083
# S3 settings (Trino ì„¤ì •ì— ë”°ë¼ ì†ì„±ëª…ì´ ë‹¤ë¥¼ ìˆ˜ ìˆìŒ)
s3.endpoint=http://RGW_HOST:8000
s3.path-style-access=true
s3.aws-access-key=CEPH_ACCESS_KEY
s3.aws-secret-key=CEPH_SECRET_KEY
```
(ì°¸ê³ : Trino ë¬¸ì„œ/ë²„ì „ì— ë”°ë¼ ì†ì„± í‚¤ê°€ ë‹¤ë¥¼ ìˆ˜ ìˆìœ¼ë‹ˆ ë³¸ì¸ íŠ¸ë¦¬ë…¸ ë²„ì „ ë¬¸ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.)

---

## ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜(í•„ìš”í•œ ê²½ìš°)
- ê¸°ì¡´ ê°ì²´ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ëœ ê°ì²´(ë²„í‚·)ë¥¼ RGWë¡œ ë³µì‚¬í•´ì•¼ í•¨.
- ë°©ë²• ì˜ˆì‹œ:
  - `rclone`ì„ ì´ìš©í•œ ë³µì‚¬: `rclone copy s3:source-bucket s3:ceph-bucket --s3-endpoint=...` (rclone configì—ì„œ ê° ë¦¬ëª¨íŠ¸ ì„¤ì • í•„ìš”)
  - `aws s3 sync --endpoint-url http://SOURCE_ENDPOINT:PORT s3://bucket/ s3://bucket/ --source-region ...` (ì¤‘ê°„ ì €ì¥ì†Œ ì‚¬ìš©)

> í° ë°ì´í„° ì´ì „ì€ ë„¤íŠ¸ì›Œí¬ ì„±ëŠ¥/ì¼ê´€ì„± ì£¼ì˜, í…ŒìŠ¤íŠ¸ í›„ ë³¸ ì´ì „ ê¶Œì¥.

---

## ê²€ì¦ ì ˆì°¨ (í…ŒìŠ¤íŠ¸ ì²´í¬ë¦¬ìŠ¤íŠ¸) âœ…
1. RGW ì ‘ê·¼ í™•ì¸
```bash
aws --endpoint-url http://RGW_HOST:8000 s3 ls
aws --endpoint-url http://RGW_HOST:8000 s3api create-bucket --bucket lakehouse
aws --endpoint-url http://RGW_HOST:8000 s3 ls
```
2. Hive metastoreì—ì„œ warehouse ê²½ë¡œ í™•ì¸
- Hive container ë‚´ì—ì„œ `hdfs`ë‚˜ `s3a` ì ‘ê·¼ í™•ì¸
3. Spark (ë¡œì»¬ ë° ì»¨í…Œì´ë„ˆ)ì—ì„œ Iceberg ì¹´íƒˆë¡œê·¸ ì—°ê²°
- `spark.sql("SHOW DATABASES IN hive_prod").show()` ì •ìƒ ë™ì‘
- í…Œì´ë¸” ìƒì„±/ì“°ê¸°/ì½ê¸° (ì˜ˆ: `df.writeTo(...).save()` í›„ `SELECT` ê²€ì‚¬)
4. Trinoì—ì„œ Iceberg ì¹´íƒˆë¡œê·¸ ì¿¼ë¦¬
- Trino UI ë˜ëŠ” CLIì—ì„œ í…Œì´ë¸” ëª©ë¡ ì¡°íšŒ ë° ì¿¼ë¦¬

---

## ë³´ì•ˆ ë° ìš´ì˜ ê³ ë ¤ì‚¬í•­ ğŸ”’
- **TLS/HTTPS**: í”„ë¡œë•ì…˜ RGWëŠ” HTTPS ì‚¬ìš© ê¶Œì¥.
- **ê¶Œí•œ ê´€ë¦¬**: RGW ì‚¬ìš©ìë³„ ìµœì†Œ ê¶Œí•œ ì •ì±… ì ìš©
- **ë¡œê·¸/ëª¨ë‹ˆí„°ë§**: Ceph MON, OSD, RGW ë¡œê·¸ ë° ë©”íŠ¸ë¦­ (Prometheus) ìˆ˜ì§‘
- **ë²„ì „ í˜¸í™˜ì„±**: Ceph ë²„ì „ê³¼ RGWì˜ S3 API í˜¸í™˜ì„± í™•ì¸ (íŠ¹íˆ SigV4)

---

## ë¡¤ë°±/ë°±ì—… ê³„íš
1. ë³€ê²½ ì „ íŒŒì¼ ë°±ì—…
```bash
cp docker-compose.yml docker-compose.yml.bak
cp hive-conf/hive-site.xml hive-site.xml.bak
cp python/fspark.py python/fspark.py.bak
cp trino-config/catalog/iceberg.properties trino-config/catalog/iceberg.properties.bak
```
2. í…ŒìŠ¤íŠ¸ì—ì„œ ë¬¸ì œ ë°œìƒ ì‹œ ë°±ì—… íŒŒì¼ë¡œ ì›ìƒë³µêµ¬í•˜ê³  ì„œë¹„ìŠ¤ë¥¼ ì¬ì‹œì‘
3. ë°ì´í„° ì´ì „ ì´ì „(ì˜ˆ: rclone ì´ì „) ë‹¨ê³„ì—ì„œ ì†ŒìŠ¤ ë°ì´í„°ë¥¼ ë³´ì¡´í•˜ë©° ê²€ì¦ ì™„ë£Œ í›„ êµì²´

---

## ë¡¤ì•„ì›ƒ ê³„íš(ê¶Œì¥ ìˆœì„œ)
1. **ì‚¬ì „ê²€ì¦**: RGW ì—”ë“œí¬ì¸íŠ¸ì™€ ìê²©ì¦ëª… í™•ì¸, ë²„í‚· ìƒì„±
2. **í™˜ê²½ ë™ê¸°í™”**: `hive-site.xml`, `fspark.py`, `trino` ì„¤ì • ìˆ˜ì • ë° ë°°í¬(ë¨¼ì € dev í™˜ê²½ì—ì„œ)
3. **ê¸°ëŠ¥ ê²€ì¦**: Spark/Trinoì—ì„œ í…Œì´ë¸” ìƒì„±/ì½ê¸°/ì“°ê¸° í…ŒìŠ¤íŠ¸
4. **ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜** (í•„ìš” ì‹œ)
5. **ëª¨ë‹ˆí„°ë§/ìš´ì˜ ì „í™˜**

---

## ì°¸ê³  ìë£Œ
- Ceph RGW ë¬¸ì„œ: https://docs.ceph.com/en/latest/radosgw/
- Trino Iceberg Connector: https://trino.io/docs/current/
- Hadoop S3A FS docs: https://hadoop.apache.org/docs/stable/hadoop-aws/tools/hadoop-aws/index.html

---

## ì¶”ê°€ ì§€ì›
ì›í•˜ì‹œë©´ ì œê°€ ì§€ê¸ˆ ë‹¤ìŒ ì‘ì—…ì„ ì§„í–‰í•˜ê² ìŠµë‹ˆë‹¤:
1. í˜„ì¬ `docker-compose.yml` ë°±ì—… ë° ìƒˆ `docker-compose.yml` ìƒì„±(ë©”ì¸ êµ¬ì„±ì—ì„œ ì´ì „ S3 ì„œë¹„ìŠ¤ ì œê±°, í•„ìš” ì‹œ RGW í…ŒìŠ¤íŠ¸ ì„œë¹„ìŠ¤ ì¶”ê°€)
2. `hive-site.xml`, `python/fspark.py`, `trino-config` ìë™ ìˆ˜ì • ë° ì»¤ë°‹
3. ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì˜ˆì‹œ ìŠ¤í¬ë¦½íŠ¸ (`rclone` ë˜ëŠ” `aws-cli`) ì œê³µê³¼ ì‹¤í–‰ ê°€ì´ë“œ

ì›í•˜ì‹œëŠ” ì‘ì—… ë²ˆí˜¸(ë˜ëŠ” ì¶”ê°€ ìš”êµ¬ì‚¬í•­)ë¥¼ ì•Œë ¤ì£¼ì„¸ìš”.
